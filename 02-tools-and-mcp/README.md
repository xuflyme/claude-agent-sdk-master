# Claude Agent SDK ç³»åˆ—æ•™ç¨‹ - ç¬¬äºŒç« ï¼šå·¥å…·è°ƒç”¨ä¸ MCP é›†æˆ

> **ğŸ¯ æ•™ç¨‹å®šä½**
> æœ¬æ•™ç¨‹æ˜¯ **Claude Agent SDK ç³»åˆ—æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†**ï¼Œåœ¨ç¬¬ä¸€ç« çš„åŸºç¡€ä¸Šï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡å·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰å’Œ MCPï¼ˆModel Context Protocolï¼‰é›†æˆï¼Œèµ‹äºˆ Agent çœŸæ­£çš„èƒ½åŠ›ã€‚

## ğŸ“– ç³»åˆ—æ•™ç¨‹è·¯çº¿å›¾

æœ¬ç³»åˆ—é‡‡ç”¨**æ¸è¿›å¼å­¦ä¹ è·¯å¾„**ï¼Œæ¯ä¸€ç« éƒ½åœ¨å‰ä¸€ç« çš„åŸºç¡€ä¸Šé€’è¿›ï¼š

- **ç¬¬ä¸€ç« **ï¼šå¿«é€Ÿå…¥é—¨ - æ ¸å¿ƒæ¦‚å¿µä¸åŸºç¡€å¯¹è¯ âœ…
- **ç¬¬äºŒç« ï¼ˆæœ¬ç« ï¼‰**ï¼šå·¥å…·è°ƒç”¨ - é›†æˆ MCP Toolsï¼Œå®ç° Agent èƒ½åŠ› â³
- **ç¬¬ä¸‰ç« **ï¼šå¤šæ¨¡æ€æ”¯æŒ - å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¯Œåª’ä½“å¤„ç†
- **ç¬¬å››ç« **ï¼šé«˜çº§ç‰¹æ€§ - è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºã€æˆæœ¬è¿½è¸ªã€æµå¼ä¼˜åŒ–

## ğŸ’¡ è®¾è®¡å“²å­¦

**è½¯ä»¶çš„æœ¬è´¨ï¼Œå½’æ ¹ç»“åº•æ˜¯å¯¹çŠ¶æ€çš„ä¼˜é›…å¤„ç†ã€‚**

æ— è®ºæ˜¯ Claude Agent SDK çš„ä¼šè¯çŠ¶æ€ã€React çš„ç»„ä»¶çŠ¶æ€ï¼Œè¿˜æ˜¯æœªæ¥çš„ Proma å¼€æºé¡¹ç›®ï¼Œæ ¸å¿ƒéƒ½æ˜¯å¦‚ä½•ä¼˜é›…åœ°ç®¡ç†å’Œè½¬æ¢çŠ¶æ€ã€‚æœ¬ç³»åˆ—æ•™ç¨‹å°†è¿™ä¸€ç†å¿µè´¯ç©¿å§‹ç»ˆï¼Œå¸®åŠ©ä½ å»ºç«‹ç³»ç»ŸåŒ–çš„æ€ç»´æ¨¡å‹ã€‚

> **âœ¨ å…³äºæœ¬æ•™ç¨‹**
> æœ¬æ•™ç¨‹çš„å¤§éƒ¨åˆ†å†…å®¹ç”± Claude Code ç¼–å†™è€Œæˆã€‚æ¯ä¸ªé¡¹ç›®éƒ½é…æœ‰è¯¦å°½çš„ `CLAUDE.md` æ–‡æ¡£ä½œä¸ºå¼€å‘æŒ‡å¼•ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ åœ¨å­¦ä¹ çš„åŸºç¡€ä¸Šè¿›è¡Œå®éªŒå’Œæ”¹åŠ¨â€”â€”**å®è·µæ˜¯æœ€å¥½çš„è€å¸ˆ**ã€‚

---

## ğŸ“ ç¬¬äºŒç« å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« åï¼Œä½ å°†æŒæ¡ï¼š

1. **å·¥å…·è°ƒç”¨æœºåˆ¶ï¼ˆTool Useï¼‰**
   - ç†è§£ Claude çš„å‡½æ•°è°ƒç”¨èƒ½åŠ›
   - å®ç°è‡ªå®šä¹‰å·¥å…·å‡½æ•°
   - å¤„ç†å·¥å…·è°ƒç”¨çš„è¯·æ±‚å’Œå“åº”

2. **MCP åè®®é›†æˆ**
   - ä»€ä¹ˆæ˜¯ Model Context Protocol
   - å¦‚ä½•é…ç½®å’Œä½¿ç”¨ MCP æœåŠ¡
   - é›†æˆå¸¸è§çš„ MCP å·¥å…·ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰

3. **Agent èƒ½åŠ›æ‰©å±•**
   - èµ‹äºˆ Agent æ‰§è¡Œå®é™…ä»»åŠ¡çš„èƒ½åŠ›
   - å¤„ç†å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œæµ
   - å®ç°å·¥å…·è°ƒç”¨çš„å¯è§†åŒ–å±•ç¤º

> **âš ï¸ å‰ç½®è¦æ±‚**
> æœ¬ç« å‡è®¾ä½ å·²ç»å®Œæˆç¬¬ä¸€ç« çš„å­¦ä¹ ï¼Œç†è§£äº† Workspaceã€Session å’Œæµå¼å“åº”ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚

---

## âš¡ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js 18+
- pnpm åŒ…ç®¡ç†å™¨
- Anthropic API Keyï¼ˆ[è·å–åœ°å€](https://console.anthropic.com/)ï¼‰

### ä¸‰æ­¥å¯åŠ¨

**1ï¸âƒ£ å®‰è£…ä¾èµ–**

```bash
pnpm install
```

**2ï¸âƒ£ é…ç½® API Key**

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹
cp .env.local.example .env.local

# ç¼–è¾‘ .env.localï¼Œå¡«å…¥ä½ çš„ API Key
ANTHROPIC_API_KEY=your-api-key-here
```

**3ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000)ï¼Œå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡å¯¹è¯ï¼

---

## âœ¨ é¡¹ç›®ç‰¹æ€§

æœ¬ç« å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ï¼š

| ç‰¹æ€§ | è¯´æ˜ | æŠ€æœ¯å®ç° |
|------|------|----------|
| ğŸ”„ **æµå¼å¯¹è¯** | å®æ—¶å±•ç¤º Claude çš„å“åº”ï¼Œç±»ä¼¼ ChatGPT | Server-Sent Events (SSE) |
| ğŸ“ **ä¼šè¯ç®¡ç†** | è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½å†å²å¯¹è¯ | JSONL æ ¼å¼æœ¬åœ°å­˜å‚¨ |
| ğŸ“ **æ–‡ä»¶æµè§ˆ** | æµè§ˆå·¥ä½œç›®å½•ï¼Œé¢„è§ˆæ–‡ä»¶å†…å®¹ | æ–‡ä»¶ç³»ç»Ÿ API |
| ğŸ¨ **Markdown æ¸²æŸ“** | ä»£ç é«˜äº®ã€è¡¨æ ¼ã€åˆ—è¡¨ç­‰å®Œæ•´æ”¯æŒ | react-markdown + highlight.js |
| ğŸ”’ **ç±»å‹å®‰å…¨** | å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ | Strict mode + Monorepo |
| ğŸ¯ **ç°ä»£ UI** | å“åº”å¼ä¸‰æ å¸ƒå±€ | Shadcn UI + Tailwind CSS |

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
02-tools-and-mcp/
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ core/                    # ğŸ“¦ æ ¸å¿ƒç±»å‹å®šä¹‰åŒ…
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ message.ts       # æ¶ˆæ¯ç›¸å…³ç±»å‹
â”‚           â”œâ”€â”€ session.ts       # ä¼šè¯ç®¡ç†ç±»å‹
â”‚           â”œâ”€â”€ workspace.ts     # å·¥ä½œç©ºé—´é…ç½®
â”‚           â””â”€â”€ storage.ts       # å­˜å‚¨æ¥å£å®šä¹‰
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                 # ğŸ  èŠå¤©ç•Œé¢
â”‚   â””â”€â”€ api/                     # ğŸ”Œ API Routes
â”‚       â”œâ”€â”€ chat/route.ts        # æµå¼å¯¹è¯ API
â”‚       â”œâ”€â”€ sessions/            # ä¼šè¯ç®¡ç† API
â”‚       â””â”€â”€ files/route.ts       # æ–‡ä»¶æµè§ˆ API
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat-interface.tsx       # ğŸ’¬ èŠå¤© UIï¼ˆä¸‰æ å¸ƒå±€ï¼‰
â”‚   â”œâ”€â”€ session-list.tsx         # ğŸ“‹ ä¼šè¯å†å²åˆ—è¡¨
â”‚   â”œâ”€â”€ file-explorer.tsx        # ğŸ“‚ æ–‡ä»¶æµè§ˆå™¨
â”‚   â””â”€â”€ markdown-renderer.tsx    # âœï¸ Markdown æ¸²æŸ“
â”‚
â”œâ”€â”€ lib/storage/                 # ğŸ’¾ æœ¬åœ°å­˜å‚¨å®ç°
â”‚   â”œâ”€â”€ index.ts                 # å­˜å‚¨é€‚é…å™¨
â”‚   â”œâ”€â”€ config.ts                # é…ç½®å­˜å‚¨
â”‚   â””â”€â”€ session.ts               # ä¼šè¯å­˜å‚¨
â”‚
â””â”€â”€ .data/                       # ğŸ“ æ•°æ®å­˜å‚¨ç›®å½•ï¼ˆgitignoredï¼‰
    â”œâ”€â”€ config.json              # å…¨å±€é…ç½®
    â””â”€â”€ sessions/*.jsonl         # ä¼šè¯å¯¹è¯è®°å½•
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ |
|------|----------|------|
| **æ¡†æ¶** | Next.js (App Router) | 16.1.6 |
| **UI åº“** | React | 19.2.3 |
| **ç±»å‹ç³»ç»Ÿ** | TypeScript (strict) | 5.x |
| **æ ·å¼æ–¹æ¡ˆ** | Tailwind CSS | 4.x |
| **ç»„ä»¶åº“** | Shadcn UI | - |
| **AI SDK** | Claude Agent SDK | latest |
| **Markdown** | react-markdown | latest |
| **ä»£ç é«˜äº®** | highlight.js | latest |
| **åŒ…ç®¡ç†å™¨** | pnpm | - |

## ğŸ“ å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start

# ä»£ç æ£€æŸ¥
pnpm lint
```

## ğŸ” æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

### 1. Workspaceï¼ˆå·¥ä½œç©ºé—´ï¼‰

Claude Agent SDK åŸºäº**æ–‡ä»¶ç³»ç»Ÿ**å·¥ä½œï¼Œæ¯ä¸ªå·¥ä½œç›®å½•å¯¹åº”ä¸€ä¸ª Workspaceï¼š

```typescript
const workspace = {
  workingDir: process.cwd(),  // å·¥ä½œç›®å½•
  env: {
    ANTHROPIC_API_KEY: "...",
  },
  agentOptions: {
    model: "claude-sonnet-4-5",
  },
};
```

### 2. Sessionï¼ˆä¼šè¯ï¼‰

æ¯ä¸ªå¯¹è¯æœ‰ç‹¬ç«‹çš„ Session IDï¼Œæ‰€æœ‰æ¶ˆæ¯å­˜å‚¨ä¸º JSONL æ–‡ä»¶ï¼š

```jsonl
{"type":"metadata","sessionId":"session-123","config":{...}}
{"type":"message","message":{"role":"user","content":"Hello"}}
{"type":"message","message":{"role":"assistant","content":"Hi!"}}
```

### 3. ä¸Šä¸‹æ–‡ç®¡ç†ï¼šAgent SDK vs ä¼ ç»Ÿ LLM

**è¿™æ˜¯ Agent SDK æœ€é‡è¦çš„èŒƒå¼è½¬å˜ä¹‹ä¸€ï¼**

**ä¼ ç»Ÿ LLM APIï¼ˆå¦‚ OpenAIï¼‰ï¼šæ‰‹åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡**

```typescript
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦æ‰‹åŠ¨æ‹¼æ¥å’Œç®¡ç†æ•´ä¸ª messages æ•°ç»„
const messages = [
  { role: "user", content: "ä½ å¥½" },
  { role: "assistant", content: "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ" },
  { role: "user", content: "æˆ‘åˆšæ‰é—®äº†ä»€ä¹ˆï¼Ÿ" }, // éœ€è¦è‡ªå·±ç»´æŠ¤å†å²
];

const response = await openai.chat.completions.create({
  model: "gpt-4",
  messages: messages, // æ¯æ¬¡éƒ½è¦ä¼ å®Œæ•´çš„å†å²
});

// æ‰‹åŠ¨è¿½åŠ æ–°æ¶ˆæ¯åˆ°æ•°ç»„
messages.push({ role: "assistant", content: response.choices[0].message.content });
```

**Claude Agent SDKï¼šè‡ªåŠ¨ä¸Šä¸‹æ–‡ç®¡ç†**

```typescript
// âœ… Agent SDK æ–¹å¼ï¼šè‡ªåŠ¨ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œåªéœ€ä¼  sessionId
// ç¬¬ä¸€è½®å¯¹è¯
const result1 = query({
  prompt: "ä½ å¥½",
  // SDK è‡ªåŠ¨åˆ›å»º session å¹¶è®°å½•å¯¹è¯
});

// ç¬¬äºŒè½®å¯¹è¯ - åªéœ€è¦ resume å‚æ•°ï¼
const result2 = query({
  prompt: "æˆ‘åˆšæ‰é—®äº†ä»€ä¹ˆï¼Ÿ",
  options: {
    resume: sessionId, // SDK è‡ªåŠ¨åŠ è½½å®Œæ•´å†å²ä¸Šä¸‹æ–‡
  },
});
```

**å…³é”®ä¼˜åŠ¿ï¼š**

| ç»´åº¦ | ä¼ ç»Ÿ LLM | Agent SDK |
|------|----------|-----------|
| **ä¸Šä¸‹æ–‡ç®¡ç†** | æ‰‹åŠ¨æ‹¼æ¥ messages æ•°ç»„ | è‡ªåŠ¨ç»´æŠ¤ï¼Œé€šè¿‡ `resume` æ¢å¤ |
| **å†å²æŒä¹…åŒ–** | éœ€è‡ªå·±å®ç°å­˜å‚¨é€»è¾‘ | å†…ç½® JSONL æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ |
| **å¤šè½®å¯¹è¯** | æ‰‹åŠ¨è¿½åŠ æ¯è½®æ¶ˆæ¯ | ä¼  sessionId å³å¯ç»§ç»­ |
| **çŠ¶æ€è¿½è¸ª** | éœ€è‡ªå·±è®°å½• tokensã€æˆæœ¬ | SDK è‡ªåŠ¨ç»Ÿè®¡ `total_cost_usd` |
| **ä»£ç å¤æ‚åº¦** | é«˜ï¼ˆéœ€è¦å¤§é‡çŠ¶æ€ç®¡ç†ä»£ç ï¼‰ | ä½ï¼ˆä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼‰ |

åœ¨æœ¬é¡¹ç›®çš„ [route.ts:53-60](app/api/chat/route.ts#L53-L60) ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®é™…åº”ç”¨ï¼š

```typescript
const result = query({
  prompt: message,
  options: {
    // å¦‚æœæœ‰ sessionIdï¼ŒSDK ä¼šè‡ªåŠ¨åŠ è½½å®Œæ•´çš„å¯¹è¯å†å²
    // æ— éœ€æ‰‹åŠ¨æ‹¼æ¥ä»»ä½• messagesï¼
    ...(shouldResume && finalSessionId ? { resume: finalSessionId } : {}),
  },
});
```

### 4. æµå¼å“åº”

ä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æµå¼è¾“å‡ºï¼š

```typescript
// API Route
const stream = new ReadableStream({
  async start(controller) {
    for await (const chunk of session.query(message)) {
      controller.enqueue(encoder.encode(`data: ${JSON.stringify(chunk)}\n\n`));
    }
  }
});

// å‰ç«¯
const reader = response.body?.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  // å¤„ç†æµå¼æ•°æ®
}
```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

æƒ³äº†è§£å®ç°ç»†èŠ‚ï¼ŸæŸ¥çœ‹ [CLAUDE.md](./CLAUDE.md) è·å–ï¼š

- å®Œæ•´çš„æ¶æ„è®¾è®¡è¯´æ˜
- å„ä¸ªç»„ä»¶çš„å®ç°ç»†èŠ‚
- ç±»å‹ç³»ç»Ÿçš„è®¾è®¡æ€è·¯
- API Routes çš„è¯¦ç»†æ–‡æ¡£

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ å¯ä»¥ï¼š

1. **ğŸ”§ å®éªŒæ”¹é€ **
   - ä¿®æ”¹ UI æ ·å¼å’Œå¸ƒå±€
   - æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹å±•ç¤º
   - ä¼˜åŒ– Markdown æ¸²æŸ“æ•ˆæœ

2. **ğŸ“– ç»§ç»­å­¦ä¹ **
   - ç¬¬äºŒç« ï¼šå·¥å…·è°ƒç”¨ - è®© Agent å…·å¤‡å®é™…èƒ½åŠ›
   - ç¬¬ä¸‰ç« ï¼šå¤šæ¨¡æ€æ”¯æŒ - å¤„ç†å›¾ç‰‡å’Œæ–‡ä»¶
   - ç¬¬å››ç« ï¼šé«˜çº§ç‰¹æ€§ - æ·±åº¦å®šåˆ¶ä½ çš„ Agent

3. **ğŸ’¡ æ¢ç´¢ SDK**
   - é˜…è¯» [Claude Agent SDK å®˜æ–¹æ–‡æ¡£](https://platform.claude.com/docs/en/agent-sdk/typescript)
   - ç ”ç©¶ SDK çš„å…¶ä»– API å’Œé…ç½®é€‰é¡¹
   - å°è¯•é›†æˆåˆ°ä½ è‡ªå·±çš„é¡¹ç›®ä¸­

---

## ğŸ”— ç›¸å…³èµ„æº

- [Claude Agent SDK æ–‡æ¡£](https://platform.claude.com/docs/en/agent-sdk/typescript) - å®˜æ–¹ SDK æ–‡æ¡£
- [Next.js æ–‡æ¡£](https://nextjs.org/docs) - Next.js App Router æŒ‡å—
- [Shadcn UI](https://ui.shadcn.com) - UI ç»„ä»¶åº“æ–‡æ¡£
- [Tailwind CSS](https://tailwindcss.com/docs) - æ ·å¼æ¡†æ¶æ–‡æ¡£

---

## ğŸ“„ License

MIT License - è‡ªç”±ä½¿ç”¨ï¼Œæ¬¢è¿æ”¹è¿›å’Œåˆ†äº«

---

<p align="center">
  <i>è¿™ä¸ªé¡¹ç›®ç”± Claude Code ååŠ©åˆ›å»º âœ¨</i><br>
  <i>å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ Star â­ï¸</i>
</p>
